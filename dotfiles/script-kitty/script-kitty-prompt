#!/usr/bin/env bash

set -euo pipefail

LOCK_FILE="/tmp/script_kitty.lock"

# If lock exists, try to kill existing process
# kill it first here to avoid window flashing
if [[ -f "$LOCK_FILE" ]]; then
  old_pid="$(cat "$LOCK_FILE" || true)"
  if [[ -n "${old_pid:-}" ]] && ps -p "$old_pid" >/dev/null 2>&1; then
    echo "Killing previous instance (PID $old_pid)..."
    kill -9 "$old_pid" 2>/dev/null || true
    rm -f "$LOCK_FILE"
    exit 0
  fi
fi

kitty --single-instance --title='script kitty' ~/nix-config/dotfiles/script-kitty/script-kitty
